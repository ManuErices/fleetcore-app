<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generador QR - FleetCore</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }
    h1 {
      color: #1e3a8a;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #64748b;
      margin-bottom: 30px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab {
      flex: 1;
      padding: 12px;
      background: #f1f5f9;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      text-align: center;
      font-weight: bold;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab:hover {
      background: #e2e8f0;
    }
    .tab.active {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      color: white;
      border-color: #1e3a8a;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    
    /* Form elements */
    label {
      display: block;
      font-weight: bold;
      color: #334155;
      margin-bottom: 5px;
      margin-top: 15px;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    /* Buttons */
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    .download-btn {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      margin-top: 10px;
      display: none;
    }
    .download-btn:hover {
      transform: translateY(-2px);
    }
    .btn-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    
    /* QR Display */
    .qrcode {
      display: flex;
      justify-content: center;
      margin: 30px 0;
      padding: 20px;
      background: #f8fafc;
      border-radius: 12px;
    }
    
    /* Info boxes */
    .info {
      background: #dbeafe;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid #3b82f6;
    }
    .info h3 {
      margin-top: 0;
      color: #1e40af;
    }
    .info.warning {
      background: #fef3c7;
      border-left-color: #f59e0b;
    }
    .info.warning h3 {
      color: #92400e;
    }
    .info.success {
      background: #d1fae5;
      border-left-color: #10b981;
    }
    .info.success h3 {
      color: #065f46;
    }
    
    .json-output {
      background: #1e293b;
      color: #10b981;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      word-wrap: break-word;
    }
    
    /* Quick buttons */
    .quick-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 15px;
    }
    .quick-btn {
      padding: 10px;
      font-size: 14px;
      margin: 0;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    }
    
    @media (max-width: 640px) {
      body {
        margin: 20px auto;
        padding: 10px;
      }
      .container {
        padding: 20px;
      }
      .tabs {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Generador QR</h1>
    <p class="subtitle">FleetCore - MPF Ingeniería</p>
    
    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('login')">Login</div>
      <div class="tab" onclick="switchTab('machine')">Maquinaria</div>
    </div>
    
    <!-- TAB LOGIN -->
    <div id="tab-login" class="tab-content active">
      <label><strong>Email:</strong></label>
      <input type="email" id="email" placeholder="operador@mpf.cl" required>
      
      <label><strong>Contraseña:</strong></label>
      <input type="password" id="password" placeholder="Ingresa la contraseña" required>
      
      <button onclick="generateLoginQR()">Generar QR</button>
      <button class="download-btn" id="downloadLoginBtn" onclick="downloadLoginQR()">Descargar QR</button>
      
      <div id="qrcodeLogin" class="qrcode" style="display: none;"></div>
      
      <div id="json-display-login"></div>
      
      <div class="info">
        <h3>Instrucciones:</h3>
        <ol>
          <li>Ingresa el email y contraseña del usuario</li>
          <li>Presiona "Generar QR"</li>
          <li>Presiona "Descargar QR" para guardarlo</li>
          <li>Imprime el QR o guárdalo en el dispositivo</li>
          <li>Escanea el QR desde la app para login automático</li>
        </ol>
      </div>
      
      <div class="info warning">
        <h3>Seguridad:</h3>
        <p>No compartas este QR públicamente. Contiene credenciales de acceso.</p>
      </div>
    </div>
    
    <!-- TAB MAQUINARIA -->
    <div id="tab-machine" class="tab-content">
      <label><strong>Código de Máquina:</strong></label>
      <input type="text" id="machine-code" placeholder="EX-01" style="text-transform: uppercase;">
      
      <button class="btn-warning" onclick="generateMachineQR()">Generar QR</button>
      <button class="download-btn" id="downloadMachineBtn" onclick="downloadMachineQR()">Descargar QR</button>
      
      <div id="qrcodeMachine" class="qrcode" style="display: none;"></div>
      
      <div id="json-display-machine"></div>
      
      <div class="info">
        <h3>Instrucciones:</h3>
        <ol>
          <li>Ingresa el código único de la máquina (ej: EX-01)</li>
          <li>Presiona "Generar QR"</li>
          <li>Descarga e imprime en sticker resistente al agua</li>
          <li>Pega en la máquina en lugar visible</li>
        </ol>
      </div>
      
      <div class="info success">
        <h3>Códigos Sugeridos:</h3>
        <p>Haz clic para autocompletar:</p>
        <div class="quick-buttons">
          <button class="quick-btn" onclick="quickFill('EX-')">EX-## Excavadora</button>
          <button class="quick-btn" onclick="quickFill('RE-')">RE-## Retro</button>
          <button class="quick-btn" onclick="quickFill('CF-')">CF-## Cargador</button>
          <button class="quick-btn" onclick="quickFill('CA-')">CA-## Camión</button>
          <button class="quick-btn" onclick="quickFill('RO-')">RO-## Rodillo</button>
          <button class="quick-btn" onclick="quickFill('MN-')">MN-## Moto</button>
        </div>
      </div>
      
      <div class="info warning">
        <h3>Recomendaciones:</h3>
        <ul>
          <li><strong>Tamaño:</strong> Imprime QR de 10x10 cm mínimo</li>
          <li><strong>Material:</strong> Usa stickers resistentes al agua y sol</li>
          <li><strong>Ubicación:</strong> Coloca en lugar accesible para escaneo</li>
          <li><strong>Calidad:</strong> Imprime a 300 DPI para mejor lectura</li>
        </ul>
      </div>
    </div>
  </div>
  
  <script>
    let qrcodeLogin = null;
    let qrcodeMachine = null;
    let currentLoginData = null;
    let currentMachineData = null;
    
    // TABS
    function switchTab(tab) {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(t => t.classList.remove('active'));
      contents.forEach(c => c.classList.remove('active'));
      
      if (tab === 'login') {
        tabs[0].classList.add('active');
        document.getElementById('tab-login').classList.add('active');
      } else {
        tabs[1].classList.add('active');
        document.getElementById('tab-machine').classList.add('active');
      }
    }
    
    // ========== LOGIN QR ==========
    function generateLoginQR() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        alert('Por favor completa email y contraseña');
        return;
      }
      
      const credentials = {
        email: email,
        password: password
      };
      
      currentLoginData = credentials;
      const jsonString = JSON.stringify(credentials);
      
      document.getElementById('json-display-login').innerHTML = `
        <div class="json-output">
          <strong>Contenido del QR:</strong><br>
          ${jsonString}
        </div>
      `;
      
      document.getElementById('qrcodeLogin').innerHTML = '';
      document.getElementById('qrcodeLogin').style.display = 'flex';
      
      qrcodeLogin = new QRCode(document.getElementById('qrcodeLogin'), {
        text: jsonString,
        width: 300,
        height: 300,
        colorDark: '#1e3a8a',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });
      
      document.getElementById('downloadLoginBtn').style.display = 'block';
    }
    
    function downloadLoginQR() {
      if (!qrcodeLogin) {
        alert('Primero genera un QR');
        return;
      }
      
      const canvas = document.querySelector('#qrcodeLogin canvas');
      if (!canvas) {
        alert('Error al obtener QR');
        return;
      }
      
      const finalCanvas = document.createElement('canvas');
      finalCanvas.width = 400;
      finalCanvas.height = 500;
      const ctx = finalCanvas.getContext('2d');
      
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
      
      ctx.fillStyle = '#1e3a8a';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('FleetCore Login', 200, 40);
      
      ctx.drawImage(canvas, 50, 70, 300, 300);
      
      ctx.fillStyle = '#64748b';
      ctx.font = '16px Arial';
      ctx.fillText(currentLoginData.email, 200, 400);
      
      ctx.font = '12px Arial';
      ctx.fillText('Generado: ' + new Date().toLocaleDateString('es-CL'), 200, 430);
      
      ctx.fillStyle = '#ef4444';
      ctx.font = 'bold 10px Arial';
      ctx.fillText('CONFIDENCIAL - NO COMPARTIR', 200, 460);
      
      finalCanvas.toBlob(function(blob) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `qr-login-${currentLoginData.email.split('@')[0]}.png`;
        a.click();
        URL.revokeObjectURL(url);
      });
    }
    
    // ========== MACHINE QR ==========
    function generateMachineQR() {
      const code = document.getElementById('machine-code').value.toUpperCase().trim();
      
      if (!code) {
        alert('Por favor ingresa el código de la máquina (ej: EX-01)');
        return;
      }
      
      currentMachineData = { code: code };
      
      document.getElementById('json-display-machine').innerHTML = `
        <div class="json-output">
          <strong>Contenido del QR:</strong><br>
          ${code}
        </div>
      `;
      
      document.getElementById('qrcodeMachine').innerHTML = '';
      document.getElementById('qrcodeMachine').style.display = 'flex';
      
      qrcodeMachine = new QRCode(document.getElementById('qrcodeMachine'), {
        text: code,
        width: 300,
        height: 300,
        colorDark: '#ea580c',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });
      
      document.getElementById('downloadMachineBtn').style.display = 'block';
    }
    
    function downloadMachineQR() {
      if (!qrcodeMachine) {
        alert('Primero genera un QR');
        return;
      }
      
      const canvas = document.querySelector('#qrcodeMachine canvas');
      if (!canvas) {
        alert('Error al obtener QR');
        return;
      }
      
      const finalCanvas = document.createElement('canvas');
      finalCanvas.width = 400;
      finalCanvas.height = 500;
      const ctx = finalCanvas.getContext('2d');
      
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
      
      ctx.strokeStyle = '#ea580c';
      ctx.lineWidth = 6;
      ctx.strokeRect(10, 10, finalCanvas.width - 20, finalCanvas.height - 20);
      
      ctx.fillStyle = '#ea580c';
      ctx.font = 'bold 28px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('FleetCore', 200, 50);
      
      ctx.drawImage(canvas, 50, 80, 300, 300);
      
      ctx.fillStyle = '#1e293b';
      ctx.font = 'bold 48px Arial';
      ctx.fillText(currentMachineData.code, 200, 425);
      
      ctx.fillStyle = '#94a3b8';
      ctx.font = '12px Arial';
      ctx.fillText('MPF Ingeniería Civil SpA', 200, 460);
      ctx.fillText('Generado: ' + new Date().toLocaleDateString('es-CL'), 200, 480);
      
      finalCanvas.toBlob(function(blob) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `qr-maquina-${currentMachineData.code}.png`;
        a.click();
        URL.revokeObjectURL(url);
      });
    }
    
    function quickFill(prefix) {
      document.getElementById('machine-code').value = prefix;
      document.getElementById('machine-code').focus();
    }
    
    document.getElementById('machine-code').addEventListener('input', function(e) {
      e.target.value = e.target.value.toUpperCase();
    });
  </script>
</body>
</html>
